module ComorbidityIndexes

using ICD10Utilities

import Base: convert

"""
    ICD4Digit

ICD10 code excluding 5th and later digits.

Quan et al codes only use 4 digits to increase compatibility with
country-specific versions of ICD-10.
"""
struct ICD4Digit <: AbstractICD10
  ANN::String
  NN::String
end

function ICD4Digit(icd::T) where {T<:AbstractICD10}
  return icd.NN == "" ? ICD4Digit(icd.ANN, "") : ICD4Digit(icd.ANN, icd.NN[[1]])
end

function ICD4Digit(str::String, punct=true)
  ANN = SubString(str, 1, 3)
  if punct
    NN = lastindex(str) < 5 ? "" : SubString(str, 5, 5)
  else
    NN = lastindex(str) < 4 ? "" : SubString(str, 4, 4)
  end
  return ICD4Digit(ANN, NN)
end

Base.convert(::ICD4Digit, x::String) = T(x)

QuanElixICD10 = (congestiveheartfailure=ICD4Digit["I09.9", "I11.0", "I13.0", "I13.2",
                                                  "I25.5", "I42.0", "I42.5", "I42.6",
                                                  "I42.7", "I42.8", "I42.9", "I43.0",
                                                  "I43.1", "I43.2", "I43.8", "I50.0",
                                                  "I50.1", "I50.9", "P29.0",],
                 cardiacarrythmias=ICD4Digit["I44.1", "I44.2", "I44.3", "I45.6", "I45.9",
                                             "I47.0", "I47.1", "I47.2", "I47.9", "I48.0",
                                             "I48.1", "I48.2", "I48.3", "I48.4", "I48.9",
                                             "I49.0", "I49.1", "I49.2", "I49.3", "I49.4",
                                             "I49.5", "I49.8", "I49.9", "R00.0", "R00.1",
                                             "R00.8", "T82.1", "Z45.0", "Z95.0",],
                 valvulardisease=ICD4Digit["A52.0", "I05.0", "I05.1", "I05.2", "I05.8",
                                           "I05.9", "I06.0", "I06.1", "I06.2", "I06.8",
                                           "I06.9", "I07.0", "I07.1", "I07.2", "I07.8",
                                           "I07.9", "I08.0", "I08.1", "I08.2", "I09.3",
                                           "I08.8", "I08.9", "I09.1", "I09.8", "I34.0",
                                           "I34.1", "I34.2", "I34.8", "I34.9", "I35.0",
                                           "I35.1", "I35.2", "I35.8", "I35.9", "I36.0",
                                           "I36.1", "I36.2", "I36.8", "I36.9", "I37.0",
                                           "I37.1", "I37.2", "I37.8", "I37.9", "I38",
                                           "I39.0", "I39.1", "I39.2", "I39.3", "I39.4",
                                           "I39.8", "Q23.0", "Q23.1", "Q23.2", "Q23.3",
                                           "Z95.2", "Z95.3", "Z95.4",],
                 pulmonarycircdisorders=ICD4Digit["I26.0", "I26.8", "I26.9", "I27.0",
                                                  "I27.1", "I27.2", "I27.8", "I27.9",],
                 periphvascdisorders=ICD4Digit["I70.0", "I70.1", "I70.2", "I70.8", "I70.9",
                                               "I71.0", "I71.1", "I71.2", "I71.3", "I71.4",
                                               "I71.5", "I71.6", "I71.8", "I71.9", "I73.1",
                                               "I73.8", "I73.9", "I77.1", "I79.0", "I79.2",
                                               "K55.1", "K55.8", "K55.9", "Z95.8", "Z95.9",],
                 hypertension=ICD4Digit["I10"],
                 hypertension_comp=ICD4Digit["I11.0", "I11.9", "I12.0", "I12.9", "I13.0",
                                             "I13.1", "I13.2", "I13.9", "I15.0", "I15.1",
                                             "I15.2", "I15.8", "I15.9",],
                 paralysis=ICD4Digit["G04.1", "G11.4", "G80.1", "G80.2", "G81.0", "G81.1",
                                     "G81.9", "G82.0", "G82.1", "G82.2", "G82.3", "G82.4",
                                     "G83.0", "G83.1", "G83.2", "G83.3", "G83.4", "G83.9",],
                 otherneurodisorders=ICD4Digit["G10", "G11.0", "G11.1", "G11.2", "G11.3",
                                               "G11.4", "G11.8", "G11.9", "G12.0", "G12.1",
                                               "G12.2", "G12.8", "G12.9", "G13.0", "G13.1",
                                               "G13.2", "G13.8", "G20", "G21.0", "G21.1",
                                               "G21.2", "G21.3", "G21.4", "G21.8", "G21.9",
                                               "G22", "G25.4", "G25.5", "G31.2", "G31.8",
                                               "G31.9", "G32.0", "G32.8", "G35", "G36.0",
                                               "G36.1", "G36.8", "G36.9", "G37.0", "G37.1",
                                               "G37.2", "G37.3", "G37.4", "G37.5", "G37.8",
                                               "G37.9", "G40.0", "G40.1", "G40.2", "G40.3",
                                               "G40.4", "G40.5", "G40.6", "G40.7", "G40.8",
                                               "G40.9", "G41.0", "G41.1", "G41.2", "G41.8",
                                               "G41.9", "G93.1", "G93.4", "R47.0", "R56.0",
                                               "R56.8",],
                 chronicpulmonarydis=ICD4Digit["I27.8", "I27.9", "J40", "J41.0", "J41.1",
                                               "J41.8", "J42", "J43.0", "J43.1", "J43.2",
                                               "J43.8", "J43.9", "J44.0", "J44.1", "J44.8",
                                               "J44.9", "J45.0", "J45.1", "J45.8", "J45.9",
                                               "J46", "J47", "J60", "J61", "J62.0", "J62.8",
                                               "J63.0", "J63.1", "J63.2", "J63.3", "J63.4",
                                               "J63.5", "J63.8", "J64", "J65", "J66.0",
                                               "J66.1", "J66.2", "J66.8", "J67.0", "J67.1",
                                               "J67.2", "J67.3", "J67.4", "J67.5", "J67.6",
                                               "J67.7", "J67.8", "J67.9", "J68.4", "J70.1",
                                               "J70.3",],
                 diabetes=ICD4Digit["E10.0", "E10.1", "E10.9", "E11.0", "E11.1", "E11.9",
                                    "E12.0", "E12.1", "E12.9", "E13.0", "E13.1", "E13.9",
                                    "E14.0", "E14.1", "E14.9",],
                 diabetes_comp=ICD4Digit["E10.2", "E10.3", "E10.4", "E10.5", "E10.6",
                                         "E10.7", "E10.8", "E11.2", "E11.3", "E11.4",
                                         "E11.5", "E11.6", "E11.7", "E11.8", "E12.2",
                                         "E12.3", "E12.4", "E12.5", "E12.6", "E12.7",
                                         "E12.8", "E13.2", "E13.3", "E13.4", "E13.5",
                                         "E13.6", "E13.7", "E13.8", "E14.2", "E14.3",
                                         "E14.4", "E14.5", "E14.6", "E14.7", "E14.8",],
                 hypothyroidism=ICD4Digit["E00.0", "E00.1", "E00.2", "E00.9", "E01.0",
                                          "E01.1", "E01.2", "E01.8", "E02", "E03.0",
                                          "E03.1", "E03.2", "E03.3", "E03.4", "E03.5",
                                          "E03.8", "E03.9", "E89.0",],
                 renalfailure=ICD4Digit["I12.0", "I13.1", "N18.0", "N18.1", "N18.2",
                                        "N18.3", "N18.4", "N18.5", "N18.8", "N18.9", "N19",
                                        "N25.0", "Z49.0", "Z49.1", "Z49.2", "Z94.0",
                                        "Z99.2",],
                 liverdisease=ICD4Digit["B18.0", "B18.1", "B18.2", "B18.8", "B18.9",
                                        "I85.0", "I85.9", "I86.4", "I98.2", "K70.0",
                                        "K70.1", "K70.2", "K70.3", "K70.4", "K70.9",
                                        "K71.1", "K71.3", "K71.4", "K71.5", "K71.7",
                                        "K72.0", "K72.1", "K72.9", "K73.0", "K73.1",
                                        "K73.2", "K73.8", "K73.9", "K74.0", "K74.1",
                                        "K74.2", "K74.3", "K74.4", "K74.5", "K74.6",
                                        "K76.0", "K76.2", "K76.3", "K76.4", "K76.5",
                                        "K76.6", "K76.7", "K76.8", "K76.9", "Z94.4",],
                 pepticulcernobleed=ICD4Digit["K25.7", "K25.9", "K26.7", "K26.9", "K27.7",
                                              "K27.9", "K28.7", "K28.9",],
                 hivaids=ICD4Digit["B20", "B21", "B22", "B24"],
                 lymphoma=ICD4Digit["C81.0", "C81.1", "C81.2", "C81.3", "C81.4", "C81.7",
                                    "C81.9", "C82.0", "C82.1", "C82.2", "C82.3", "C82.4",
                                    "C82.5", "C82.6", "C82.7", "C82.9", "C83.0", "C83.1",
                                    "C83.2", "C83.3", "C83.4", "C83.5", "C83.6", "C83.7",
                                    "C83.8", "C83.9", "C84.0", "C84.1", "C84.2", "C84.3",
                                    "C84.4", "C84.5", "C84.6", "C84.7", "C84.8", "C84.9",
                                    "C85.0", "C85.1", "C85.2", "C85.7", "C85.9", "C88.0",
                                    "C88.1", "C88.2", "C88.3", "C88.4", "C88.7", "C88.9",
                                    "C96.0", "C96.1", "C96.2", "C96.3", "C96.4", "C96.5",
                                    "C96.6", "C96.7", "C96.8", "C96.9", "C90.0", "C90.2",],
                 metastaticcancer=ICD4Digit["C77.0", "C77.1", "C77.2", "C77.3", "C77.4",
                                            "C77.5", "C77.8", "C77.9", "C78.0", "C78.1",
                                            "C78.2", "C78.3", "C78.4", "C78.5", "C78.6",
                                            "C78.7", "C78.8", "C79.0", "C79.1", "C79.2",
                                            "C79.3", "C79.4", "C79.5", "C79.6", "C79.7",
                                            "C79.8", "C80.0", "C80.9",],
                 solidtumor=ICD4Digit["C00.0", "C00.1", "C00.2", "C00.3", "C00.4", "C00.5",
                                      "C00.6", "C00.8", "C00.9", "C01", "C02.0", "C02.1",
                                      "C02.2", "C02.3", "C02.4", "C02.8", "C02.9", "C03.0",
                                      "C03.1", "C03.9", "C04.0", "C04.1", "C04.8", "C04.9",
                                      "C05.0", "C05.1", "C05.2", "C05.8", "C05.9", "C06.0",
                                      "C06.1", "C06.2", "C06.8", "C06.9", "C07", "C08.0",
                                      "C08.1", "C08.8", "C08.9", "C09.0", "C09.1", "C09.8",
                                      "C09.9", "C10.0", "C10.1", "C10.2", "C10.3", "C10.4",
                                      "C10.8", "C10.9", "C11.0", "C11.1", "C11.2", "C11.3",
                                      "C11.8", "C11.9", "C12", "C13.0", "C13.1", "C13.2",
                                      "C13.8", "C18.9", "C14.0", "C14.2", "C14.8", "C15.0",
                                      "C15.1", "C15.2", "C15.3", "C15.4", "C15.5", "C15.8",
                                      "C15.9", "C16.0", "C16.1", "C16.2", "C16.3", "C16.4",
                                      "C16.5", "C16.6", "C16.8", "C16.9", "C17.0", "C17.1",
                                      "C17.2", "C17.3", "C17.8", "C17.9", "C18.0", "C18.1",
                                      "C18.2", "C18.3", "C18.4", "C18.5", "C18.6", "C18.7",
                                      "C18.8", "C18.9", "C19", "C20", "C21.0", "C21.1",
                                      "C21.2", "C21.8", "C22.0", "C22.1", "C22.2", "C22.3",
                                      "C22.4", "C22.7", "C22.9", "C23", "C24.0", "C24.1",
                                      "C24.8", "C24.9", "C25.0", "C25.1", "C25.2", "C25.3",
                                      "C25.4", "C25.7", "C25.8", "C25.9", "C26.0", "C26.1",
                                      "C26.8", "C26.9", "C30.0", "C30.1", "C31.0", "C31.1",
                                      "C31.2", "C31.3", "C31.8", "C31.9", "C32.0", "C32.1",
                                      "C32.2", "C32.3", "C32.8", "C32.9", "C33", "C34.0",
                                      "C34.1", "C34.2", "C34.3", "C34.8", "C34.9", "C37",
                                      "C38.0", "C38.1", "C38.2", "C38.3", "C38.4", "C38.8",
                                      "C39.0", "C39.8", "C39.9", "C40.0", "C40.1", "C40.2",
                                      "C40.3", "C40.8", "C40.9", "C41.0", "C41.1", "C41.2",
                                      "C41.3", "C41.4", "C41.8", "C41.9", "C43.0", "C43.1",
                                      "C43.2", "C43.3", "C43.4", "C43.5", "C43.6", "C43.7",
                                      "C43.8", "C43.9", "C45.0", "C45.1", "C45.2", "C45.7",
                                      "C45.9", "C46.0", "C46.1", "C46.2", "C46.3", "C46.7",
                                      "C46.8", "C46.9", "C47.0", "C47.1", "C47.2", "C47.3",
                                      "C47.4", "C47.5", "C47.6", "C47.7", "C47.8", "C47.9",
                                      "C48.0", "C48.1", "C48.2", "C48.8", "C49.0", "C49.1",
                                      "C49.2", "C49.3", "C49.4", "C49.5", "C49.6", "C49.8",
                                      "C49.9", "C50.0", "C50.1", "C50.2", "C50.3", "C50.4",
                                      "C50.5", "C50.6", "C50.8", "C50.9", "C51.0", "C51.1",
                                      "C51.2", "C51.8", "C51.9", "C52", "C53.0", "C53.1",
                                      "C53.8", "C53.9", "C54.0", "C54.1", "C54.2", "C54.3",
                                      "C54.8", "C54.9", "C55", "C56", "C57.0", "C57.1",
                                      "C57.2", "C57.3", "C57.4", "C57.7", "C57.8", "C57.9",
                                      "C58", "C60.0", "C60.1", "C60.2", "C60.8", "C60.9",
                                      "C61", "C62.0", "C62.1", "C62.9", "C63.0", "C63.1",
                                      "C63.2", "C63.7", "C63.8", "C63.9", "C64", "C65",
                                      "C66", "C67.0", "C67.1", "C67.2", "C67.3", "C67.4",
                                      "C67.5", "C67.6", "C67.7", "C67.8", "C67.9", "C68.0",
                                      "C68.1", "C68.8", "C68.9", "C69.0", "C69.1", "C69.2",
                                      "C69.3", "C69.4", "C69.5", "C69.6", "C69.7", "C69.8",
                                      "C69.9", "C70.0", "C70.1", "C70.9", "C71.0", "C71.1",
                                      "C71.2", "C71.3", "C71.4", "C71.5", "C71.6", "C71.7",
                                      "C71.8", "C71.9", "C72.0", "C72.1", "C72.2", "C72.3",
                                      "C72.4", "C72.5", "C72.8", "C72.9", "C73", "C74.0",
                                      "C74.1", "C74.9", "C75.0", "C75.1", "C75.2", "C75.3",
                                      "C75.4", "C75.5", "C75.8", "C75.9", "C76.0", "C76.1",
                                      "C76.2", "C76.3", "C76.4", "C76.5", "C76.8", "C76.9",
                                      "C97",],
                 rheumatoidarthritis=ICD4Digit["L94.0", "L94.1", "L94.3", "M05.0", "M05.1",
                                               "M05.2", "M05.3", "M05.8", "M05.9", "M06.0",
                                               "M06.1", "M06.2", "M06.3", "M06.4", "M06.8",
                                               "M06.9", "M08.0", "M08.1", "M08.2", "M08.3",
                                               "M08.4", "M08.8", "M08.9", "M12.0", "M12.3",
                                               "M30.0", "M30.1", "M30.2", "M30.3", "M30.8",
                                               "M31.0", "M31.1", "M31.2", "M31.3", "M32.0",
                                               "M32.1", "M32.8", "M32.9", "M33.0", "M33.1",
                                               "M33.2", "M33.9", "M34.0", "M34.1", "M34.2",
                                               "M34.8", "M34.9", "M35.0", "M35.1", "M35.2",
                                               "M35.3", "M35.4", "M35.5", "M35.6", "M35.7",
                                               "M35.8", "M35.9", "M45.0", "M46.1", "M46.8",
                                               "M46.9",],
                 coagulopathy=ICD4Digit["D65", "D66", "D67", "D68.0", "D68.1", "D68.2",
                                        "D68.3", "D68.4", "D68.5", "D68.6", "D68.8",
                                        "D68.9", "D69.1", "D69.3", "D69.4", "D69.5",
                                        "D69.6",],
                 obesity=ICD4Digit["E66.0", "E66.1", "E66.2", "E66.3", "E66.8", "E66.9"],
                 weightloss=ICD4Digit["E40", "E41", "E42", "E43", "E44.0", "E44.1", "E45",
                                      "E46", "R63.4", "R64",],
                 fluidelectrolytedisorders=ICD4Digit["E22.2", "E86", "E87.0", "E87.1",
                                                     "E87.2", "E87.3", "E87.4", "E87.5",
                                                     "E87.6", "E87.7", "E87.8",],
                 bloodlossanaemia=ICD4Digit["D50.0"],
                 deficiencyanaemia=ICD4Digit["D50.8", "D50.9", "D51.0", "D51.1", "D51.2",
                                             "D51.3", "D51.8", "D51.9", "D52.0", "D52.1",
                                             "D52.8", "D52.9", "D53.0", "D53.1", "D53.2",
                                             "D53.8", "D53.9",],
                 alcoholabuse=ICD4Digit["F10.0", "F10.1", "F10.2", "F10.3", "F10.4",
                                        "F10.5", "F10.6", "F10.7", "F10.8", "F10.9", "E52",
                                        "G62.1", "I42.6", "K29.2", "K70.0", "K70.3",
                                        "K70.9", "T51.0", "T51.1", "T51.2", "T51.3",
                                        "T51.8", "T51.9", "Z50.2", "Z71.4", "Z72.1",],
                 drugabuse=ICD4Digit["F11.0", "F11.1", "F11.2", "F11.3", "F11.4", "F11.5",
                                     "F11.6", "F11.7", "F11.8", "F11.9", "F12.0", "F12.1",
                                     "F12.2", "F12.3", "F12.4", "F12.5", "F12.6", "F12.7",
                                     "F12.8", "F12.9", "F13.0", "F13.1", "F13.2", "F13.3",
                                     "F13.4", "F13.5", "F13.6", "F13.7", "F13.8", "F13.9",
                                     "F14.0", "F14.1", "F14.2", "F14.3", "F14.4", "F14.5",
                                     "F14.6", "F14.7", "F14.8", "F14.9", "F15.0", "F15.1",
                                     "F15.2", "F15.3", "F15.4", "F15.5", "F15.6", "F15.7",
                                     "F15.8", "F15.9", "F16.0", "F16.1", "F16.2", "F16.3",
                                     "F16.4", "F16.5", "F16.6", "F16.7", "F16.8", "F16.9",
                                     "F18.0", "F18.1", "F18.2", "F18.3", "F18.4", "F18.5",
                                     "F18.6", "F18.7", "F18.8", "F18.9", "F19.0", "F19.1",
                                     "F19.2", "F19.3", "F19.4", "F19.5", "F19.6", "F19.7",
                                     "F19.8", "F19.9", "Z71.5", "Z72.2",],
                 psychoses=ICD4Digit["F20.0", "F20.1", "F20.2", "F20.3", "F20.4", "F20.5",
                                     "F20.6", "F20.8", "F20.9", "F22.0", "F22.8", "F22.9",
                                     "F23.0", "F23.1", "F23.2", "F23.3", "F23.8", "F23.9",
                                     "F24", "F25.0", "F25.1", "F25.2", "F25.8", "F25.9",
                                     "F28", "F29", "F30.2", "F31.2", "F31.5",],
                 depression=ICD4Digit["F20.4", "F31.3", "F31.4", "F31.5", "F32.0", "F32.1",
                                      "F32.2", "F32.3", "F32.8", "F32.9", "F33.0", "F33.1",
                                      "F33.2", "F33.3", "F33.4", "F33.8", "F33.9", "F34.1",
                                      "F41.2", "F43.2",])

end # module
